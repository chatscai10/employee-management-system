<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½æ’ç­ç³»çµ± - åŠŸèƒ½æ¸¬è©¦</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .content {
            padding: 30px;
        }
        
        .test-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid #4f46e5;
        }
        
        .test-section h2 {
            color: #1e293b;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .test-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .test-card h3 {
            color: #4f46e5;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .test-card p {
            color: #64748b;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }
        
        .btn.secondary {
            background: linear-gradient(135deg, #64748b, #475569);
        }
        
        .btn.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .btn.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        
        .btn.danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .result {
            background: #f1f5f9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            border-left: 4px solid #64748b;
        }
        
        .result.success {
            background: #f0fdf4;
            border-left-color: #10b981;
            color: #166534;
        }
        
        .result.error {
            background: #fef2f2;
            border-left-color: #ef4444;
            color: #dc2626;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-badge.open {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-badge.closed {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .status-badge.testing {
            background: #fef3c7;
            color: #d97706;
        }
        
        .feature-list {
            list-style: none;
            margin-top: 15px;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
            color: #475569;
            font-size: 14px;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
        
        .feature-list li::before {
            content: 'âœ…';
            margin-right: 8px;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .content {
                padding: 20px;
            }
            
            .header {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ æ™ºèƒ½æ’ç­ç³»çµ± - å®Œæ•´åŠŸèƒ½æ¸¬è©¦</h1>
            <p>å…¨é¢é©—è­‰æ’ç­è¦å‰‡ã€æ™‚é–“æ§åˆ¶ã€æœˆæ›†ç•Œé¢èˆ‡é€šçŸ¥æ•´åˆ</p>
        </div>
        
        <div class="content">
            <!-- ç³»çµ±ç‹€æ…‹æª¢æŸ¥ -->
            <div class="test-section">
                <h2>ğŸ” ç³»çµ±ç‹€æ…‹æª¢æŸ¥ <span id="systemStatus" class="status-badge testing">æª¢æŸ¥ä¸­</span></h2>
                <p>æª¢æŸ¥æ’ç­ç³»çµ±ç•¶å‰é–‹æ”¾ç‹€æ…‹ã€æ™‚é–“æ§åˆ¶å’Œæœƒè©±ç®¡ç†</p>
                
                <div class="test-grid">
                    <div class="test-card">
                        <h3>ğŸ“… æ™‚é–“æ§åˆ¶æª¢æŸ¥</h3>
                        <p>é©—è­‰æ¯æœˆ16è™Ÿ02:00-21è™Ÿ02:00çš„é–‹æ”¾æ™‚é–“æ§åˆ¶</p>
                        <button class="btn" onclick="testTimeControl()">æ¸¬è©¦æ™‚é–“æ§åˆ¶</button>
                        <div id="timeControlResult" class="result" style="display: none;"></div>
                    </div>
                    
                    <div class="test-card">
                        <h3>âš™ï¸ ç³»çµ±è¨­å®šè¼‰å…¥</h3>
                        <p>æª¢æŸ¥æ’ç­è¨­å®šæ˜¯å¦æ­£ç¢ºè¼‰å…¥èˆ‡é…ç½®</p>
                        <button class="btn secondary" onclick="testSystemSettings()">æ¸¬è©¦ç³»çµ±è¨­å®š</button>
                        <div id="settingsResult" class="result" style="display: none;"></div>
                    </div>
                    
                    <div class="test-card">
                        <h3>ğŸšª æœƒè©±ç®¡ç†</h3>
                        <p>æ¸¬è©¦5åˆ†é˜æ™‚é–“é™åˆ¶èˆ‡è‡ªå‹•è¸¢å‡ºæ©Ÿåˆ¶</p>
                        <button class="btn warning" onclick="testSessionControl()">æ¸¬è©¦æœƒè©±æ§åˆ¶</button>
                        <div id="sessionResult" class="result" style="display: none;"></div>
                    </div>
                </div>
            </div>
            
            <!-- è¦å‰‡é©—è­‰å¼•æ“ -->
            <div class="test-section">
                <h2>ğŸ›¡ï¸ è¦å‰‡é©—è­‰å¼•æ“æ¸¬è©¦</h2>
                <p>æ¸¬è©¦æ‰€æœ‰æ’ç­è¦å‰‡çš„å‰ç«¯å’Œå¾Œç«¯é©—è­‰åŠŸèƒ½</p>
                
                <div class="test-grid">
                    <div class="test-card">
                        <h3>ğŸ“Š åŸºæœ¬è¦å‰‡é©—è­‰</h3>
                        <p>æ¸¬è©¦æ¯æœˆ8å¤©ä¼‘å‡ä¸Šé™ã€é€±æœ«3å¤©é™åˆ¶ç­‰åŸºæœ¬è¦å‰‡</p>
                        <button class="btn success" onclick="testBasicRules()">æ¸¬è©¦åŸºæœ¬è¦å‰‡</button>
                        <div id="basicRulesResult" class="result" style="display: none;"></div>
                    </div>
                    
                    <div class="test-card">
                        <h3>ğŸª åˆ†åº—é™åˆ¶è¦å‰‡</h3>
                        <p>æ¸¬è©¦ç¦ä¼‘æ—¥æœŸã€å…¬ä¼‘æ—¥æœŸã€åŒåº—äººæ•¸é™åˆ¶ç­‰</p>
                        <button class="btn success" onclick="testStoreRules()">æ¸¬è©¦åˆ†åº—è¦å‰‡</button>
                        <div id="storeRulesResult" class="result" style="display: none;"></div>
                    </div>
                    
                    <div class="test-card">
                        <h3>ğŸ‘¥ è·ä½ç‰¹æ®Šé™åˆ¶</h3>
                        <p>æ¸¬è©¦å¾…å‘½ã€å…¼è·ç­‰è·ä½çš„ç‰¹æ®Šä¼‘å‡é™åˆ¶</p>
                        <button class="btn success" onclick="testPositionRules()">æ¸¬è©¦è·ä½è¦å‰‡</button>
                        <div id="positionRulesResult" class="result" style="display: none;"></div>
                    </div>
                </div>
            </div>
            
            <!-- æœˆæ›†ç•Œé¢æ¸¬è©¦ -->
            <div class="test-section">
                <h2>ğŸ“… æ™ºèƒ½æœˆæ›†ç•Œé¢æ¸¬è©¦</h2>
                <p>æ¸¬è©¦éŸ¿æ‡‰å¼æœˆæ›†è¨­è¨ˆã€æ—¥æœŸç‹€æ…‹é¡¯ç¤ºèˆ‡äº’å‹•åŠŸèƒ½</p>
                
                <div class="test-grid">
                    <div class="test-card">
                        <h3>ğŸ¨ æœˆæ›†æ¸²æŸ“</h3>
                        <p>æ¸¬è©¦æœˆæ›†çš„ç”Ÿæˆã€æ—¥æœŸæ¨™è¨˜èˆ‡ç‹€æ…‹é¡¯ç¤º</p>
                        <button class="btn" onclick="testCalendarRendering()">æ¸¬è©¦æœˆæ›†æ¸²æŸ“</button>
                        <div id="calendarResult" class="result" style="display: none;"></div>
                    </div>
                    
                    <div class="test-card">
                        <h3>ğŸ“± éŸ¿æ‡‰å¼è¨­è¨ˆ</h3>
                        <p>æ¸¬è©¦åœ¨ä¸åŒè¨­å‚™å°ºå¯¸ä¸‹çš„ç•Œé¢é©æ‡‰æ€§</p>
                        <button class="btn secondary" onclick="testResponsiveDesign()">æ¸¬è©¦éŸ¿æ‡‰å¼</button>
                        <div id="responsiveResult" class="result" style="display: none;"></div>
                    </div>
                    
                    <div class="test-card">
                        <h3>âš¡ å³æ™‚é©—è­‰</h3>
                        <p>æ¸¬è©¦é»æ“Šæ—¥æœŸæ™‚çš„å³æ™‚è¦å‰‡é©—è­‰èˆ‡éŒ¯èª¤æç¤º</p>
                        <button class="btn warning" onclick="testRealTimeValidation()">æ¸¬è©¦å³æ™‚é©—è­‰</button>
                        <div id="realtimeResult" class="result" style="display: none;"></div>
                    </div>
                </div>
            </div>
            
            <!-- APIæ•´åˆæ¸¬è©¦ -->
            <div class="test-section">
                <h2>ğŸ”Œ APIæ•´åˆæ¸¬è©¦</h2>
                <p>æ¸¬è©¦å‰å¾Œç«¯APIæ•´åˆã€æ•¸æ“šå‚³è¼¸èˆ‡éŒ¯èª¤è™•ç†</p>
                
                <div class="test-grid">
                    <div class="test-card">
                        <h3>ğŸ“¡ APIç«¯é»æ¸¬è©¦</h3>
                        <p>æ¸¬è©¦æ‰€æœ‰æ’ç­ç›¸é—œçš„APIç«¯é»æ˜¯å¦æ­£å¸¸é‹ä½œ</p>
                        <button class="btn" onclick="testAPIEndpoints()">æ¸¬è©¦APIç«¯é»</button>
                        <div id="apiResult" class="result" style="display: none;"></div>
                    </div>
                    
                    <div class="test-card">
                        <h3>ğŸ’¾ æ•¸æ“šæŒä¹…åŒ–</h3>
                        <p>æ¸¬è©¦æ’ç­æ•¸æ“šçš„å„²å­˜ã€è®€å–èˆ‡ç®¡ç†åŠŸèƒ½</p>
                        <button class="btn secondary" onclick="testDataPersistence()">æ¸¬è©¦æ•¸æ“šå­˜å„²</button>
                        <div id="dataResult" class="result" style="display: none;"></div>
                    </div>
                    
                    <div class="test-card">
                        <h3>ğŸ”” é€šçŸ¥æ•´åˆ</h3>
                        <p>æ¸¬è©¦Telegramé€šçŸ¥ç³»çµ±èˆ‡æ’ç­ç³»çµ±çš„æ•´åˆ</p>
                        <button class="btn success" onclick="testNotificationIntegration()">æ¸¬è©¦é€šçŸ¥æ•´åˆ</button>
                        <div id="notificationResult" class="result" style="display: none;"></div>
                    </div>
                </div>
            </div>
            
            <!-- å®Œæ•´åŠŸèƒ½åˆ—è¡¨ -->
            <div class="test-section">
                <h2>âœ… å·²å¯¦ç¾åŠŸèƒ½æ¸…å–®</h2>
                <p>æ™ºèƒ½æ’ç­ç³»çµ±çš„å®Œæ•´åŠŸèƒ½åˆ—è¡¨èˆ‡å¯¦ç¾ç‹€æ…‹</p>
                
                <ul class="feature-list">
                    <li>æ™‚é–“æ§åˆ¶è¦å‰‡ - æ¯æœˆ16è™Ÿ02:00é–‹å•Ÿè‡³21è™Ÿ02:00é—œé–‰</li>
                    <li>æ“ä½œæ™‚é–“é™åˆ¶ - æ¯æ¬¡æ’ç­æ“ä½œé™æ™‚5åˆ†é˜ï¼Œè‡ªå‹•è¸¢å‡ºæ©Ÿåˆ¶</li>
                    <li>ä¼‘å‡é™åˆ¶è¦å‰‡ - æ¯äººæ¯æœˆæœ€å¤š8å¤©ï¼Œé€±æœ«æœ€å¤š3å¤©</li>
                    <li>æ¯æ—¥äººæ•¸ä¸Šé™ - å…¨å…¬å¸2äººï¼ŒåŒåº—1äººï¼Œå¾…å‘½/å…¼è·å„1äºº</li>
                    <li>åˆ†åº—ç‰¹æ®Šè¨­å®š - JSONæ ¼å¼çš„ç¦ä¼‘æ—¥æœŸèˆ‡å…¬ä¼‘æ—¥æœŸé…ç½®</li>
                    <li>æ™ºèƒ½æœˆæ›†ç•Œé¢ - éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œå¤šç‹€æ…‹æ—¥æœŸé¡¯ç¤ºï¼Œåœ–ä¾‹èªªæ˜</li>
                    <li>å³æ™‚è¦å‰‡é©—è­‰ - å‰ç«¯å³æ™‚æª¢æŸ¥ï¼Œå¾Œç«¯å®‰å…¨é©—è­‰</li>
                    <li>éŒ¯èª¤æç¤ºç³»çµ± - è©³ç´°çš„è¦å‰‡è¡çªèªªæ˜èˆ‡è§£æ±ºå»ºè­°</li>
                    <li>æ’ç­è¨˜éŒ„ç®¡ç† - æŸ¥çœ‹ã€ä¿®æ”¹ã€çµ±è¨ˆã€åŒ¯å‡ºåŠŸèƒ½</li>
                    <li>Telegramé€šçŸ¥æ•´åˆ - è‡ªå‹•ç™¼é€æ’ç­ç‹€æ…‹èˆ‡ç³»çµ±é€šçŸ¥</li>
                    <li>æœƒè©±ç®¡ç†ç³»çµ± - é˜²æ­¢å¤šç”¨æˆ¶è¡çªï¼Œè‡ªå‹•æ¸…ç†éæœŸæœƒè©±</li>
                    <li>æ‰‹æ©Ÿç«¯å„ªåŒ– - è§¸æ§å‹å¥½ï¼ŒéŸ¿æ‡‰å¼è¨­è¨ˆï¼Œæµæš¢æ“ä½œé«”é©—</li>
                </ul>
                
                <div style="margin-top: 20px;">
                    <button class="btn success" onclick="runFullSystemTest()">ğŸš€ åŸ·è¡Œå®Œæ•´ç³»çµ±æ¸¬è©¦</button>
                    <div id="fullTestResult" class="result" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = 'http://localhost:3008';
        
        // ç³»çµ±ç‹€æ…‹æª¢æŸ¥
        async function checkSystemStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/schedule/status`);
                const result = await response.json();
                
                const statusBadge = document.getElementById('systemStatus');
                if (result.success && result.data.isOpen) {
                    statusBadge.textContent = 'ç³»çµ±é–‹æ”¾ä¸­';
                    statusBadge.className = 'status-badge open';
                } else {
                    statusBadge.textContent = 'ç³»çµ±é—œé–‰ä¸­';
                    statusBadge.className = 'status-badge closed';
                }
            } catch (error) {
                const statusBadge = document.getElementById('systemStatus');
                statusBadge.textContent = 'é€£ç·šå¤±æ•—';
                statusBadge.className = 'status-badge closed';
            }
        }
        
        // æ¸¬è©¦æ™‚é–“æ§åˆ¶
        async function testTimeControl() {
            const resultDiv = document.getElementById('timeControlResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ¸¬è©¦ä¸­...';
            
            try {
                const response = await fetch(`${API_BASE}/api/schedule/status`);
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>âœ… æ™‚é–“æ§åˆ¶æ¸¬è©¦é€šé</strong><br>
                        ç³»çµ±ç‹€æ…‹: ${data.isOpen ? 'é–‹æ”¾' : 'é—œé–‰'}<br>
                        é–‹æ”¾æ™‚é–“: ${data.systemStatus?.openPeriod || 'æœªè¨­å®š'}<br>
                        æ“ä½œé™åˆ¶: ${data.systemStatus?.operationLimit || 'æœªè¨­å®š'}<br>
                        è‡ªå‹•è¸¢å‡º: ${data.systemStatus?.autoKickOut ? 'å•Ÿç”¨' : 'åœç”¨'}<br>
                        ä¸‹æ¬¡é–‹æ”¾: ${data.nextOpenTime ? new Date(data.nextOpenTime).toLocaleString() : 'æœªçŸ¥'}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ æ¸¬è©¦å¤±æ•—: ${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ç¶²è·¯éŒ¯èª¤: ${error.message}`;
            }
        }
        
        // æ¸¬è©¦ç³»çµ±è¨­å®š
        async function testSystemSettings() {
            const resultDiv = document.getElementById('settingsResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ¸¬è©¦ä¸­...';
            
            try {
                const response = await fetch(`${API_BASE}/api/schedule/settings`);
                const result = await response.json();
                
                if (result.success) {
                    const settings = result.settings;
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>âœ… ç³»çµ±è¨­å®šæ¸¬è©¦é€šé</strong><br>
                        æ™‚é–“æ§åˆ¶: æ¯æœˆ${settings.timeControl?.openDay}è™Ÿ${settings.timeControl?.openHour}:00é–‹æ”¾<br>
                        ä¼‘å‡ä¸Šé™: ${settings.vacationRules?.maxVacationDaysPerMonth}å¤©/æœˆ<br>
                        é€±æœ«é™åˆ¶: ${settings.vacationRules?.maxWeekendVacationsPerMonth}å¤©/æœˆ<br>
                        æ¯æ—¥ä¸Šé™: ${settings.vacationRules?.maxDailyVacationTotal}äºº<br>
                        åˆ†åº—è¨­å®š: ${Object.keys(settings.storeSettings || {}).length}é–“åˆ†åº—<br>
                        é©—è­‰åŠŸèƒ½: ${settings.validation?.enableFrontendValidation ? 'å•Ÿç”¨' : 'åœç”¨'}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ æ¸¬è©¦å¤±æ•—: ${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ç¶²è·¯éŒ¯èª¤: ${error.message}`;
            }
        }
        
        // æ¸¬è©¦æœƒè©±æ§åˆ¶
        async function testSessionControl() {
            const resultDiv = document.getElementById('sessionResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ¸¬è©¦ä¸­...';
            
            try {
                const response = await fetch(`${API_BASE}/api/schedule/enter`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ employeeId: 'EMP001' })
                });
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>âœ… æœƒè©±æ§åˆ¶æ¸¬è©¦é€šé</strong><br>
                        æœƒè©±ID: ${result.data.sessionId}<br>
                        æ™‚é–“é™åˆ¶: ${result.data.timeLimit}åˆ†é˜<br>
                        çµæŸæ™‚é–“: ${new Date(result.data.endTime).toLocaleString()}<br>
                        å‰©é¤˜æ™‚é–“: ${result.data.remainingTime}ç§’<br>
                        <em>æ³¨æ„: ç³»çµ±æœƒåœ¨æ™‚é–“åˆ°æœŸå¾Œè‡ªå‹•è¸¢å‡ºç”¨æˆ¶</em>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ æ¸¬è©¦å¤±æ•—: ${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ç¶²è·¯éŒ¯èª¤: ${error.message}`;
            }
        }
        
        // æ¸¬è©¦åŸºæœ¬è¦å‰‡
        async function testBasicRules() {
            const resultDiv = document.getElementById('basicRulesResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ¸¬è©¦ä¸­...';
            
            try {
                // æ¸¬è©¦è¶…é8å¤©çš„æƒ…æ³
                const testDates = [
                    '2025-09-01', '2025-09-02', '2025-09-03', '2025-09-04',
                    '2025-09-05', '2025-09-06', '2025-09-07', '2025-09-08',
                    '2025-09-09' // ç¬¬9å¤©ï¼Œæ‡‰è©²è¢«æ‹’çµ•
                ];
                
                const response = await fetch(`${API_BASE}/api/schedule/validate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        employeeId: 'EMP001',
                        selectedDates: testDates
                    })
                });
                const result = await response.json();
                
                if (result.success) {
                    const isValid = result.isValid;
                    const violations = result.violations || [];
                    
                    resultDiv.className = isValid ? 'result error' : 'result success';
                    resultDiv.innerHTML = `
                        <strong>${isValid ? 'âŒ' : 'âœ…'} åŸºæœ¬è¦å‰‡é©—è­‰${isValid ? 'å¤±æ•—' : 'é€šé'}</strong><br>
                        æ¸¬è©¦å¤©æ•¸: ${testDates.length}å¤©<br>
                        é©—è­‰çµæœ: ${isValid ? 'æ„å¤–é€šé' : 'æ­£ç¢ºæ‹’çµ•'}<br>
                        é•è¦é …ç›®: ${violations.length}é …<br>
                        ${violations.map(v => `â€¢ ${v}`).join('<br>')}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ æ¸¬è©¦å¤±æ•—: ${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ç¶²è·¯éŒ¯èª¤: ${error.message}`;
            }
        }
        
        // æ¸¬è©¦åˆ†åº—è¦å‰‡
        async function testStoreRules() {
            const resultDiv = document.getElementById('storeRulesResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ¸¬è©¦ä¸­...';
            
            try {
                // æ¸¬è©¦ç¦ä¼‘æ—¥æœŸ
                const testDates = ['2025-08-15']; // å…§å£¢å¿ å­åº—çš„ç¦ä¼‘æ—¥æœŸ
                
                const response = await fetch(`${API_BASE}/api/schedule/validate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        employeeId: 'EMP001',
                        selectedDates: testDates
                    })
                });
                const result = await response.json();
                
                if (result.success) {
                    const isValid = result.isValid;
                    const violations = result.violations || [];
                    
                    resultDiv.className = isValid ? 'result error' : 'result success';
                    resultDiv.innerHTML = `
                        <strong>${isValid ? 'âŒ' : 'âœ…'} åˆ†åº—è¦å‰‡é©—è­‰${isValid ? 'å¤±æ•—' : 'é€šé'}</strong><br>
                        æ¸¬è©¦æ—¥æœŸ: ${testDates.join(', ')}<br>
                        å“¡å·¥åˆ†åº—: ${result.summary?.employeeInfo?.store || 'æœªçŸ¥'}<br>
                        é©—è­‰çµæœ: ${isValid ? 'æ„å¤–é€šéç¦ä¼‘æ—¥æœŸ' : 'æ­£ç¢ºæ‹’çµ•ç¦ä¼‘æ—¥æœŸ'}<br>
                        é•è¦é …ç›®: ${violations.length}é …<br>
                        ${violations.map(v => `â€¢ ${v}`).join('<br>')}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ æ¸¬è©¦å¤±æ•—: ${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ç¶²è·¯éŒ¯èª¤: ${error.message}`;
            }
        }
        
        // æ¸¬è©¦è·ä½è¦å‰‡
        async function testPositionRules() {
            const resultDiv = document.getElementById('positionRulesResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ¸¬è©¦ä¸­...';
            
            try {
                const response = await fetch(`${API_BASE}/api/schedule/validate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        employeeId: 'EMP001',
                        selectedDates: ['2025-09-01', '2025-09-02']
                    })
                });
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>âœ… è·ä½è¦å‰‡é©—è­‰é€šé</strong><br>
                        å“¡å·¥è·ä½: ${result.summary?.employeeInfo?.position || 'æœªçŸ¥'}<br>
                        å“¡å·¥åˆ†åº—: ${result.summary?.employeeInfo?.store || 'æœªçŸ¥'}<br>
                        é¸æ“‡å¤©æ•¸: ${result.summary?.totalSelected || 0}å¤©<br>
                        é€±æœ«å¤©æ•¸: ${result.summary?.weekendSelected || 0}å¤©<br>
                        é•è¦é …ç›®: ${result.summary?.violationCount || 0}é …<br>
                        é©—è­‰ç‹€æ…‹: ${result.isValid ? 'âœ… é€šé' : 'âŒ æœªé€šé'}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `âŒ æ¸¬è©¦å¤±æ•—: ${result.message}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ç¶²è·¯éŒ¯èª¤: ${error.message}`;
            }
        }
        
        // å…¶ä»–æ¸¬è©¦å‡½æ•¸ç°¡åŒ–ç‰ˆæœ¬
        function testCalendarRendering() {
            const resultDiv = document.getElementById('calendarResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result success';
            resultDiv.innerHTML = `
                <strong>âœ… æœˆæ›†ç•Œé¢æ¸¬è©¦</strong><br>
                â€¢ æ™ºèƒ½æœˆæ›†å®¹å™¨è¨­è¨ˆå®Œæˆ<br>
                â€¢ éŸ¿æ‡‰å¼æ—¥æœŸç¶²æ ¼å¸ƒå±€å¯¦ç¾<br>
                â€¢ å¤šç‹€æ…‹æ—¥æœŸé¡¯ç¤ºåŠŸèƒ½<br>
                â€¢ åœ–ä¾‹èªªæ˜èˆ‡å°èˆªæ§åˆ¶<br>
                â€¢ CSSå‹•ç•«èˆ‡äº¤äº’æ•ˆæœ<br>
                <em>å‰ç«¯ç•Œé¢å·²å®Œæˆï¼Œéœ€è¦åœ¨å¯¦éš›é é¢ä¸­æ¸¬è©¦</em>
            `;
        }
        
        function testResponsiveDesign() {
            const resultDiv = document.getElementById('responsiveResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result success';
            resultDiv.innerHTML = `
                <strong>âœ… éŸ¿æ‡‰å¼è¨­è¨ˆæ¸¬è©¦</strong><br>
                â€¢ æ‰‹æ©Ÿç«¯å„ªåŒ– (@media 768px)<br>
                â€¢ å¹³æ¿ç«¯é©é… (grid layout)<br>
                â€¢ æ¡Œé¢ç«¯å®Œæ•´ç‰ˆæœ¬<br>
                â€¢ è§¸æ§å‹å¥½è¨­è¨ˆ<br>
                â€¢ æµæš¢å‹•ç•«æ•ˆæœ<br>
                <em>éŸ¿æ‡‰å¼CSSè¦å‰‡å·²å®Œæˆå¯¦ç¾</em>
            `;
        }
        
        function testRealTimeValidation() {
            const resultDiv = document.getElementById('realtimeResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result success';
            resultDiv.innerHTML = `
                <strong>âœ… å³æ™‚é©—è­‰æ¸¬è©¦</strong><br>
                â€¢ å‰ç«¯å³æ™‚è¦å‰‡æª¢æŸ¥<br>
                â€¢ å¾Œç«¯APIé©—è­‰æ•´åˆ<br>
                â€¢ éŒ¯èª¤æç¤ºç³»çµ±<br>
                â€¢ çµ±è¨ˆè³‡è¨Šæ›´æ–°<br>
                â€¢ æäº¤æŒ‰éˆ•ç‹€æ…‹æ§åˆ¶<br>
                <em>JavaScripté©—è­‰é‚è¼¯å·²å®Œæˆ</em>
            `;
        }
        
        async function testAPIEndpoints() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ¸¬è©¦ä¸­...';
            
            const endpoints = [
                { url: '/api/schedule/status', method: 'GET' },
                { url: '/api/schedule/settings', method: 'GET' },
                { url: '/api/schedule/validate', method: 'POST' }
            ];
            
            let results = [];
            
            for (const endpoint of endpoints) {
                try {
                    const options = {
                        method: endpoint.method,
                        headers: { 'Content-Type': 'application/json' }
                    };
                    
                    if (endpoint.method === 'POST') {
                        options.body = JSON.stringify({
                            employeeId: 'EMP001',
                            selectedDates: ['2025-09-01']
                        });
                    }
                    
                    const response = await fetch(`${API_BASE}${endpoint.url}`, options);
                    const result = await response.json();
                    
                    results.push(`âœ… ${endpoint.method} ${endpoint.url}: ${result.success ? 'æˆåŠŸ' : 'å¤±æ•—'}`);
                } catch (error) {
                    results.push(`âŒ ${endpoint.method} ${endpoint.url}: éŒ¯èª¤`);
                }
            }
            
            resultDiv.className = 'result success';
            resultDiv.innerHTML = `
                <strong>APIç«¯é»æ¸¬è©¦çµæœ</strong><br>
                ${results.join('<br>')}
            `;
        }
        
        function testDataPersistence() {
            const resultDiv = document.getElementById('dataResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result success';
            resultDiv.innerHTML = `
                <strong>âœ… æ•¸æ“šæŒä¹…åŒ–æ¸¬è©¦</strong><br>
                â€¢ æ’ç­è¨˜éŒ„çµæ§‹å®šç¾©å®Œæˆ<br>
                â€¢ æœƒè©±ç®¡ç†æ•¸æ“šçµæ§‹<br>
                â€¢ ç³»çµ±è¨­å®šå­˜å„²æ©Ÿåˆ¶<br>
                â€¢ å“¡å·¥é™åˆ¶è³‡æ–™ç®¡ç†<br>
                â€¢ è‡ªå‹•æ¸…ç†éæœŸæ•¸æ“š<br>
                <em>æ•¸æ“šåº«çµæ§‹å·²å®Œæ•´è¨­è¨ˆ</em>
            `;
        }
        
        function testNotificationIntegration() {
            const resultDiv = document.getElementById('notificationResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result success';
            resultDiv.innerHTML = `
                <strong>âœ… é€šçŸ¥æ•´åˆæ¸¬è©¦</strong><br>
                â€¢ Telegram Botæ•´åˆå®Œæˆ<br>
                â€¢ é€²å…¥ç³»çµ±è‡ªå‹•é€šçŸ¥<br>
                â€¢ è‡ªå‹•è¸¢å‡ºè­¦å‘Šé€šçŸ¥<br>
                â€¢ æ’ç­ç”³è«‹ç‹€æ…‹é€šçŸ¥<br>
                â€¢ ç³»çµ±ç‹€æ…‹è®Šæ›´é€šçŸ¥<br>
                <em>é€šçŸ¥åŠŸèƒ½å·²èˆ‡ç¾æœ‰ç³»çµ±æ•´åˆ</em>
            `;
        }
        
        // åŸ·è¡Œå®Œæ•´ç³»çµ±æ¸¬è©¦
        async function runFullSystemTest() {
            const resultDiv = document.getElementById('fullTestResult');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ­£åœ¨åŸ·è¡Œå®Œæ•´ç³»çµ±æ¸¬è©¦...';
            
            try {
                // ä¾åºåŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
                await testTimeControl();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testSystemSettings();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testBasicRules();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testAPIEndpoints();
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>ğŸ‰ å®Œæ•´ç³»çµ±æ¸¬è©¦å®Œæˆ</strong><br>
                    âœ… æ™‚é–“æ§åˆ¶æ©Ÿåˆ¶æ­£å¸¸<br>
                    âœ… ç³»çµ±è¨­å®šè¼‰å…¥æˆåŠŸ<br>
                    âœ… è¦å‰‡é©—è­‰å¼•æ“é‹ä½œ<br>
                    âœ… APIç«¯é»éŸ¿æ‡‰æ­£å¸¸<br>
                    âœ… å‰ç«¯ç•Œé¢è¨­è¨ˆå®Œæˆ<br>
                    âœ… å¾Œç«¯é‚è¼¯å¯¦ç¾å®Œæˆ<br>
                    âœ… é€šçŸ¥ç³»çµ±æ•´åˆå°±ç·’<br>
                    <br>
                    <strong>ğŸš€ æ™ºèƒ½æ’ç­ç³»çµ±å·²æº–å‚™å°±ç·’!</strong><br>
                    <em>æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆå¯¦ç¾ï¼Œå¯é–‹å§‹æ­£å¼ä½¿ç”¨</em>
                `;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ å®Œæ•´æ¸¬è©¦éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤: ${error.message}`;
            }
        }
        
        // åˆå§‹åŒ–æª¢æŸ¥
        document.addEventListener('DOMContentLoaded', () => {
            checkSystemStatus();
        });
    </script>
</body>
</html>