<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å“¡ç³»çµ± - ä¼æ¥­å“¡å·¥ç®¡ç†</title>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ‘¨â€ğŸ’¼</text></svg>">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="mock-data.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Microsoft YaHei', Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh;
            color: #333;
        }
        
        /* æ‰‹æ©Ÿç«¯å„ªå…ˆè¨­è¨ˆ */
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }
        
        /* é ‚éƒ¨å°èˆª */
        .admin-header {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .admin-header h1 {
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 1.8em;
        }
        
        .admin-header p {
            color: #7f8c8d;
            font-size: 1em;
        }
        
        /* åŠŸèƒ½é¸å–® */
        .admin-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .menu-item {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: none;
            font-size: 14px;
        }
        
        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .menu-item.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .menu-item i {
            font-size: 2em;
            margin-bottom: 10px;
            display: block;
            color: #3498db;
        }
        
        .menu-item.active i {
            color: white;
        }
        
        /* å…§å®¹å€åŸŸ */
        .admin-content {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: 400px;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-title {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            font-size: 1.3em;
        }
        
        /* è¡¨å–®æ¨£å¼ */
        .form-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-weight: bold;
            color: #2c3e50;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #3498db;
            outline: none;
        }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            min-height: 48px; /* æ‰‹æ©Ÿç«¯å‹å¥½çš„æœ€å°è§¸æ§å€åŸŸ */
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        /* å¡ç‰‡æ¨£å¼ */
        .card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        
        .card-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        /* è¡¨æ ¼æ¨£å¼ */
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .mobile-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .mobile-table th,
        .mobile-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .mobile-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }
        
        /* ç‹€æ…‹æ¨™ç±¤ */
        .status-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-active {
            background: #d4edda;
            color: #155724;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* é€šçŸ¥æ¨£å¼ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            max-width: 300px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success { background: #27ae60; }
        .notification.error { background: #e74c3c; }
        .notification.info { background: #3498db; }
        
        /* è¼‰å…¥å‹•ç•« */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ç…§ç‰‡ç®¡ç†æ¨£å¼ */
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .photo-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .photo-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        .photo-thumbnail {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        
        .photo-info {
            font-size: 14px;
        }
        
        .photo-type {
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 15px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 5px;
        }
        
        .photo-type.revenue {
            background: #27ae60;
        }
        
        .photo-type.maintenance {
            background: #e67e22;
        }
        
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat-label {
            display: block;
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .stat-value {
            display: block;
            color: #2c3e50;
            font-size: 24px;
            font-weight: bold;
        }
        
        .pagination-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .pagination-buttons button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            margin: 0 5px;
            cursor: pointer;
        }
        
        .pagination-buttons button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        
        .card-actions {
            float: right;
        }
        
        .card-actions .btn {
            margin-left: 10px;
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (min-width: 768px) {
            .container {
                max-width: 1200px;
                padding: 20px;
            }
            
            .admin-menu {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .form-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 480px) {
            .admin-header h1 {
                font-size: 1.5em;
            }
            
            .admin-menu {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .menu-item {
                padding: 15px 10px;
            }
            
            .menu-item i {
                font-size: 1.5em;
            }
        }
        
        /* éš±è—å…ƒç´  */
        .hidden {
            display: none !important;
        }
        
        /* åˆ†åº—è¨­å®šç‰¹æ®Šæ¨£å¼ */
        .store-grid {
            display: grid;
            gap: 15px;
        }
        
        @media (min-width: 768px) {
            .store-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
        }
        
        .store-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }
        
        .store-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        /* å“¡å·¥ç®¡ç†æ¨£å¼ */
        .employee-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .employee-info {
            flex: 1;
            min-width: 200px;
        }
        
        .employee-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .employee-actions .btn {
            padding: 8px 12px;
            font-size: 14px;
            min-height: auto;
        }
        
        /* æ¸¬è©¦å·¥å…·æ¨£å¼ */
        .test-results-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        
        .test-result-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        
        .test-result-pass {
            background: #d4edda;
            border-left-color: #28a745;
        }
        
        .test-result-fail {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        
        .test-result-info {
            background: #d1ecf1;
            border-left-color: #17a2b8;
        }
        
        /* é€šçŸ¥ç®¡ç†æ¨£å¼ */
        .notification-history {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .notification-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        
        .notification-success {
            border-left-color: #28a745;
        }
        
        .notification-error {
            border-left-color: #dc3545;
        }
        
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .notification-time {
            font-size: 12px;
            color: #6c757d;
        }
        
        .notification-group {
            font-size: 12px;
            background: #007bff;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        /* å‚™ä»½ç®¡ç†æ¨£å¼ */
        .backup-status {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .backup-list {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .backup-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #007bff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .backup-info {
            flex: 1;
        }
        
        .backup-size {
            font-size: 12px;
            color: #6c757d;
        }
        
        .backup-time {
            font-size: 12px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç®¡ç†å“¡æ¨™é¡Œ -->
        <div class="admin-header">
            <h1><i class="fas fa-user-shield"></i> ç®¡ç†å“¡ç³»çµ±</h1>
            <p>ä¼æ¥­å“¡å·¥ç®¡ç†ç³»çµ± - å®Œæ•´åŠŸèƒ½ç‰ˆ</p>
        </div>
        
        <!-- åŠŸèƒ½é¸å–® -->
        <div class="admin-menu">
            <button class="menu-item active" onclick="showSection('dashboard')">
                <i class="fas fa-tachometer-alt"></i>
                ç³»çµ±ç¸½è¦½
            </button>
            <button class="menu-item" onclick="showSection('stores')">
                <i class="fas fa-store"></i>
                åˆ†åº—è¨­å®š
            </button>
            <button class="menu-item" onclick="showSection('employees')">
                <i class="fas fa-users"></i>
                å“¡å·¥ç®¡ç†
            </button>
            <button class="menu-item" onclick="showSection('ordering')">
                <i class="fas fa-shopping-cart"></i>
                å«è²¨å“é …
            </button>
            <button class="menu-item" onclick="showSection('schedule')">
                <i class="fas fa-calendar-alt"></i>
                æ’ç­è¨­å®š
            </button>
            <button class="menu-item" onclick="showSection('voting')">
                <i class="fas fa-vote-yea"></i>
                æŠ•ç¥¨è¨­å®š
            </button>
            <button class="menu-item" onclick="showSection('revenue')">
                <i class="fas fa-dollar-sign"></i>
                ç‡Ÿæ”¶è¨­å®š
            </button>
            <button class="menu-item" onclick="showSection('photos')">
                <i class="fas fa-images"></i>
                ç…§ç‰‡ç®¡ç†
            </button>
            <button class="menu-item" onclick="showSection('test-tools')">
                <i class="fas fa-flask"></i>
                æ¸¬è©¦å·¥å…·
            </button>
            <button class="menu-item" onclick="showSection('notifications')">
                <i class="fas fa-bell"></i>
                é€šçŸ¥ç®¡ç†
            </button>
            <button class="menu-item" onclick="showSection('backup')">
                <i class="fas fa-database"></i>
                å‚™ä»½ç®¡ç†
            </button>
            <button class="menu-item" onclick="showSection('system')">
                <i class="fas fa-cogs"></i>
                ç³»çµ±è¨­å®š
            </button>
        </div>
        
        <!-- å…§å®¹å€åŸŸ -->
        <div class="admin-content">
            <!-- ç³»çµ±ç¸½è¦½ -->
            <div id="dashboard" class="content-section active">
                <h2 class="section-title">
                    <i class="fas fa-tachometer-alt"></i> ç³»çµ±ç¸½è¦½
                </h2>
                
                <div class="form-grid">
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-users"></i> å“¡å·¥çµ±è¨ˆ
                        </div>
                        <div id="employee-stats">è¼‰å…¥ä¸­...</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-store"></i> åˆ†åº—çµ±è¨ˆ
                        </div>
                        <div id="store-stats">è¼‰å…¥ä¸­...</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-chart-line"></i> ä»Šæ—¥æ•¸æ“š
                        </div>
                        <div id="daily-stats">è¼‰å…¥ä¸­...</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-bell"></i> ç³»çµ±ç‹€æ…‹
                        </div>
                        <div id="system-status">è¼‰å…¥ä¸­...</div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="testAllAPIs()">
                    <i class="fas fa-flask"></i> æ¸¬è©¦æ‰€æœ‰API
                </button>
            </div>
            
            <!-- åˆ†åº—è¨­å®š -->
            <div id="stores" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-store"></i> åˆ†åº—ç®¡ç†è¨­å®š
                </h2>
                
                <div class="store-grid" id="stores-container">
                    <!-- åˆ†åº—å¡ç‰‡å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
                
                <button class="btn btn-success" onclick="showAddStoreForm()">
                    <i class="fas fa-plus"></i> æ–°å¢åˆ†åº—
                </button>
            </div>
            
            <!-- å“¡å·¥ç®¡ç† -->
            <div id="employees" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-users"></i> å“¡å·¥è³‡æ–™ç®¡ç†
                </h2>
                
                <div class="form-group">
                    <button class="btn btn-primary" onclick="loadEmployees()">
                        <i class="fas fa-sync"></i> é‡æ–°è¼‰å…¥å“¡å·¥åˆ—è¡¨
                    </button>
                </div>
                
                <div id="employees-container">
                    <!-- å“¡å·¥åˆ—è¡¨å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- å«è²¨å“é … -->
            <div id="ordering" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-shopping-cart"></i> å«è²¨å“é …æ¸…å–®è¨­å®š
                </h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="item-supplier">ä¾›æ‡‰å•†</label>
                        <input type="text" id="item-supplier" placeholder="ä¾‹ï¼šè¯è¯é£Ÿå“">
                    </div>
                    <div class="form-group">
                        <label for="item-brand">å“ç‰Œ</label>
                        <input type="text" id="item-brand" placeholder="ä¾‹ï¼šé£›é£›">
                    </div>
                    <div class="form-group">
                        <label for="item-product">å“é …</label>
                        <input type="text" id="item-product" placeholder="ä¾‹ï¼šé›èƒ¸è‚‰">
                    </div>
                    <div class="form-group">
                        <label for="item-unit">å–®ä½</label>
                        <input type="text" id="item-unit" placeholder="ä¾‹ï¼šä»½">
                    </div>
                    <div class="form-group">
                        <label for="item-price">å–®åƒ¹</label>
                        <input type="number" id="item-price" placeholder="150">
                    </div>
                    <div class="form-group">
                        <label for="item-category">é¡åˆ¥</label>
                        <select id="item-category">
                            <option value="">è«‹é¸æ“‡é¡åˆ¥</option>
                            <option value="è‚‰é¡">è‚‰é¡</option>
                            <option value="é…èœ">é…èœ</option>
                            <option value="åŸæ–™">åŸæ–™</option>
                            <option value="èª¿æ–™">èª¿æ–™</option>
                            <option value="ä¸»é£Ÿ">ä¸»é£Ÿ</option>
                            <option value="é£²æ–™">é£²æ–™</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="addOrderingItem()">
                    <i class="fas fa-plus"></i> æ–°å¢å“é …
                </button>
                
                <div id="ordering-items-container">
                    <!-- å“é …åˆ—è¡¨å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- æ’ç­è¨­å®š -->
            <div id="schedule" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-calendar-alt"></i> æ’ç­ç³»çµ±åƒæ•¸è¨­å®š
                </h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="max-vacation-days">æ¯äººä¼‘å‡ä¸Šé™å¤©æ•¸</label>
                        <input type="number" id="max-vacation-days" value="8">
                    </div>
                    <div class="form-group">
                        <label for="max-daily-vacation">æ¯æ—¥ä¼‘å‡ç¸½ä¸Šé™äººæ•¸</label>
                        <input type="number" id="max-daily-vacation" value="2">
                    </div>
                    <div class="form-group">
                        <label for="max-weekend-vacation">é€±æœ«ä¼‘å‡ä¸Šé™å¤©æ•¸</label>
                        <input type="number" id="max-weekend-vacation" value="3">
                    </div>
                    <div class="form-group">
                        <label for="operation-time">æ’ç­æ“ä½œæ™‚é–“(åˆ†é˜)</label>
                        <input type="number" id="operation-time" value="5">
                    </div>
                    <div class="form-group">
                        <label for="open-day">æ’ç­é–‹å•Ÿæ—¥æœŸ</label>
                        <input type="number" id="open-day" value="16" min="1" max="31">
                    </div>
                    <div class="form-group">
                        <label for="close-day">æ’ç­é—œé–‰æ—¥æœŸ</label>
                        <input type="number" id="close-day" value="21" min="1" max="31">
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="saveScheduleSettings()">
                    <i class="fas fa-save"></i> å„²å­˜æ’ç­è¨­å®š
                </button>
            </div>
            
            <!-- æŠ•ç¥¨è¨­å®š -->
            <div id="voting" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-vote-yea"></i> æŠ•ç¥¨éšç´šåƒæ•¸è¨­å®š
                </h2>
                
                <div id="voting-positions-container">
                    <!-- è·ä½è¨­å®šå°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
                
                <button class="btn btn-success" onclick="showAddPositionForm()">
                    <i class="fas fa-plus"></i> æ–°å¢è·ä½
                </button>
            </div>
            
            <!-- ç‡Ÿæ”¶è¨­å®š -->
            <div id="revenue" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-dollar-sign"></i> ç‡Ÿæ”¶çé‡‘å…¬å¼è¨­å®š
                </h2>
                
                <div class="card">
                    <div class="card-header">å¹³æ—¥çé‡‘å…¬å¼</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="weekday-threshold">çé‡‘é–€æª»</label>
                            <input type="number" id="weekday-threshold" value="13000">
                        </div>
                        <div class="form-group">
                            <label for="weekday-rate">çé‡‘æ¯”ä¾‹(%)</label>
                            <input type="number" id="weekday-rate" value="30" step="0.1">
                        </div>
                    </div>
                    <p>å…¬å¼ï¼šç¾å ´é‡‘é¡ + ç†Šè²“é‡‘é¡(æ‰£é™¤35%æœå‹™è²») + UBERé‡‘é¡(æ‰£é™¤35%æœå‹™è²») > <span id="weekday-display">13000</span> å‰‡å– <span id="weekday-rate-display">30%</span> ä½œç‚ºçé‡‘</p>
                </div>
                
                <div class="card">
                    <div class="card-header">å‡æ—¥çé‡‘å…¬å¼</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="holiday-threshold">çé‡‘é–€æª»</label>
                            <input type="number" id="holiday-threshold" value="0">
                        </div>
                        <div class="form-group">
                            <label for="holiday-rate">çé‡‘æ¯”ä¾‹(%)</label>
                            <input type="number" id="holiday-rate" value="38" step="0.1">
                        </div>
                    </div>
                    <p>å…¬å¼ï¼šç¸½é‡‘é¡ >= <span id="holiday-display">0</span> å‰‡å– <span id="holiday-rate-display">38%</span> ä½œç‚ºçé‡‘</p>
                </div>
                
                <button class="btn btn-success" onclick="saveRevenueSettings()">
                    <i class="fas fa-save"></i> å„²å­˜ç‡Ÿæ”¶è¨­å®š
                </button>
            </div>
            
            <!-- ç…§ç‰‡ç®¡ç† -->
            <div id="photos" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-images"></i> ç…§ç‰‡ç®¡ç†
                </h2>
                
                <!-- ç…§ç‰‡çµ±è¨ˆ -->
                <div class="card">
                    <div class="card-header">ç…§ç‰‡çµ±è¨ˆ</div>
                    <div id="photo-stats" class="form-grid">
                        <div class="stat-item">
                            <span class="stat-label">ç¸½ç…§ç‰‡æ•¸</span>
                            <span class="stat-value" id="total-photos">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ç‡Ÿæ”¶ç…§ç‰‡</span>
                            <span class="stat-value" id="revenue-photos">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ç¶­ä¿®ç…§ç‰‡</span>
                            <span class="stat-value" id="maintenance-photos">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- ç…§ç‰‡ç¯©é¸ -->
                <div class="card">
                    <div class="card-header">ç…§ç‰‡æŸ¥è©¢ç¯©é¸</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="photo-type">ç…§ç‰‡é¡å‹</label>
                            <select id="photo-type">
                                <option value="">å…¨éƒ¨</option>
                                <option value="revenue">ç‡Ÿæ”¶ç…§ç‰‡</option>
                                <option value="maintenance">ç¶­ä¿®ç…§ç‰‡</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="photo-store">åˆ†åº—</label>
                            <select id="photo-store">
                                <option value="">å…¨éƒ¨åˆ†åº—</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="photo-start-date">é–‹å§‹æ—¥æœŸ</label>
                            <input type="date" id="photo-start-date">
                        </div>
                        <div class="form-group">
                            <label for="photo-end-date">çµæŸæ—¥æœŸ</label>
                            <input type="date" id="photo-end-date">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="searchPhotos()">
                        <i class="fas fa-search"></i> æœå°‹ç…§ç‰‡
                    </button>
                </div>
                
                <!-- ç…§ç‰‡åˆ—è¡¨ -->
                <div class="card">
                    <div class="card-header">
                        ç…§ç‰‡åˆ—è¡¨
                        <div class="card-actions">
                            <button class="btn btn-secondary" onclick="refreshPhotos()">
                                <i class="fas fa-sync"></i> é‡æ–°æ•´ç†
                            </button>
                        </div>
                    </div>
                    
                    <!-- åˆ†é æ§åˆ¶ -->
                    <div class="pagination-controls">
                        <span id="photo-pagination-info">ç¬¬ 1 é ï¼Œå…± 0 ç­†</span>
                        <div class="pagination-buttons">
                            <button id="photo-prev-page" onclick="changePhotoPage(-1)" disabled>
                                <i class="fas fa-chevron-left"></i> ä¸Šä¸€é 
                            </button>
                            <button id="photo-next-page" onclick="changePhotoPage(1)" disabled>
                                <i class="fas fa-chevron-right"></i> ä¸‹ä¸€é 
                            </button>
                        </div>
                    </div>
                    
                    <!-- ç…§ç‰‡ç¶²æ ¼ -->
                    <div id="photo-grid" class="photo-grid">
                        <div class="loading">è¼‰å…¥ä¸­...</div>
                    </div>
                </div>
            </div>
            
            <!-- ç³»çµ±è¨­å®š -->
            <div id="system" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-cogs"></i> ç³»çµ±è¨­å®š
                </h2>
                
                <div class="card">
                    <div class="card-header">ä½œå»¢åŠŸèƒ½é–‹é—œ</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="void-attendance" checked> è€ƒå‹¤è¨˜éŒ„å¯ä½œå»¢
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="void-revenue" checked> ç‡Ÿæ”¶è¨˜éŒ„å¯ä½œå»¢
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="void-ordering" checked> å«è²¨è¨˜éŒ„å¯ä½œå»¢
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="void-maintenance" checked> ç¶­ä¿®è¨˜éŒ„å¯ä½œå»¢
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">Telegramé€šçŸ¥è¨­å®š</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="bot-token">Bot Token</label>
                            <input type="text" id="bot-token" value="7659930552:AAF_jF1rAXFnjFO176-9X5fKfBwbrko8BNc">
                        </div>
                        <div class="form-group">
                            <label for="boss-group">è€é—†ç¾¤çµ„ID</label>
                            <input type="text" id="boss-group" value="-1002658082392">
                        </div>
                        <div class="form-group">
                            <label for="employee-group">å“¡å·¥ç¾¤çµ„ID</label>
                            <input type="text" id="employee-group" value="-1002658082392">
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="saveSystemSettings()">
                    <i class="fas fa-save"></i> å„²å­˜ç³»çµ±è¨­å®š
                </button>
            </div>
            
            <!-- æ¸¬è©¦å·¥å…· -->
            <div id="test-tools" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-flask"></i> ç³»çµ±æ¸¬è©¦å·¥å…·
                </h2>
                
                <div class="card">
                    <div class="card-header">æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦</div>
                    <div class="form-grid">
                        <button class="btn btn-primary" onclick="runTest('employee-management')">
                            <i class="fas fa-users"></i> å“¡å·¥ç®¡ç†æ¸¬è©¦
                        </button>
                        <button class="btn btn-primary" onclick="runTest('attendance-system')">
                            <i class="fas fa-clock"></i> è€ƒå‹¤ç³»çµ±æ¸¬è©¦
                        </button>
                        <button class="btn btn-primary" onclick="runTest('revenue-system')">
                            <i class="fas fa-chart-line"></i> ç‡Ÿæ”¶ç³»çµ±æ¸¬è©¦
                        </button>
                        <button class="btn btn-primary" onclick="runTest('ordering-system')">
                            <i class="fas fa-shopping-cart"></i> å«è²¨ç³»çµ±æ¸¬è©¦
                        </button>
                        <button class="btn btn-primary" onclick="runTest('maintenance-system')">
                            <i class="fas fa-wrench"></i> ç¶­ä¿®ç³»çµ±æ¸¬è©¦
                        </button>
                        <button class="btn btn-primary" onclick="runTest('scheduling-system')">
                            <i class="fas fa-calendar"></i> æ’ç­ç³»çµ±æ¸¬è©¦
                        </button>
                        <button class="btn btn-primary" onclick="runTest('voting-system')">
                            <i class="fas fa-vote-yea"></i> æŠ•ç¥¨ç³»çµ±æ¸¬è©¦
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">æ“´å±•åŠŸèƒ½æ¸¬è©¦</div>
                    <div class="form-grid">
                        <button class="btn btn-info" onclick="runTest('announcement-system')">
                            <i class="fas fa-bullhorn"></i> å…¬å‘Šç³»çµ±æ¸¬è©¦
                        </button>
                        <button class="btn btn-info" onclick="runTest('photo-upload')">
                            <i class="fas fa-camera"></i> ç…§ç‰‡ä¸Šå‚³æ¸¬è©¦
                        </button>
                        <button class="btn btn-info" onclick="runTest('item-reports')">
                            <i class="fas fa-exclamation-triangle"></i> ç•°å¸¸å›å ±æ¸¬è©¦
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">ç³»çµ±åŠŸèƒ½æ¸¬è©¦</div>
                    <div class="form-grid">
                        <button class="btn btn-warning" onclick="runTest('data-backup')">
                            <i class="fas fa-database"></i> æ•¸æ“šå‚™ä»½æ¸¬è©¦
                        </button>
                        <button class="btn btn-warning" onclick="runTest('system-health')">
                            <i class="fas fa-heartbeat"></i> ç³»çµ±å¥åº·æª¢æŸ¥
                        </button>
                        <button class="btn btn-success" onclick="runAllTests()">
                            <i class="fas fa-play"></i> åŸ·è¡Œå…¨éƒ¨æ¸¬è©¦
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">æ¸¬è©¦çµæœ</div>
                    <div id="test-results" class="test-results-area">
                        é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...
                    </div>
                </div>
            </div>
            
            <!-- é€šçŸ¥ç®¡ç† -->
            <div id="notifications" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-bell"></i> é€šçŸ¥ç³»çµ±ç®¡ç†
                </h2>
                
                <div class="card">
                    <div class="card-header">ç¾¤çµ„é…ç½®</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="boss-group-id">è€é—†ç¾¤çµ„ID</label>
                            <input type="text" id="boss-group-id" value="-1002658082392" readonly>
                            <small>é‡è¦æ¥­å‹™é€šçŸ¥ç¾¤çµ„</small>
                        </div>
                        <div class="form-group">
                            <label for="employee-group-id">å“¡å·¥ç¾¤çµ„ID</label>
                            <input type="text" id="employee-group-id" value="-1002658082393" readonly>
                            <small>ä¸€èˆ¬å“¡å·¥é€šçŸ¥ç¾¤çµ„</small>
                        </div>
                        <div class="form-group">
                            <label for="system-group-id">ç³»çµ±ç¾¤çµ„ID</label>
                            <input type="text" id="system-group-id" value="-1002658082394" readonly>
                            <small>ç³»çµ±é‹è¡Œç‹€æ…‹é€šçŸ¥ç¾¤çµ„</small>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">æ¸¬è©¦é€šçŸ¥</div>
                    <div class="form-grid">
                        <button class="btn btn-danger" onclick="sendTestNotification('boss')">
                            <i class="fas fa-user-tie"></i> æ¸¬è©¦è€é—†ç¾¤çµ„
                        </button>
                        <button class="btn btn-primary" onclick="sendTestNotification('employee')">
                            <i class="fas fa-users"></i> æ¸¬è©¦å“¡å·¥ç¾¤çµ„
                        </button>
                        <button class="btn btn-info" onclick="sendTestNotification('system')">
                            <i class="fas fa-server"></i> æ¸¬è©¦ç³»çµ±ç¾¤çµ„
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label for="custom-message">è‡ªè¨‚æ¸¬è©¦è¨Šæ¯</label>
                        <textarea id="custom-message" rows="3" placeholder="è¼¸å…¥è‡ªè¨‚æ¸¬è©¦è¨Šæ¯ï¼ˆå¯é¸ï¼‰"></textarea>
                    </div>
                    
                    <button class="btn btn-success" onclick="sendCustomNotification()">
                        <i class="fas fa-paper-plane"></i> ç™¼é€è‡ªè¨‚é€šçŸ¥
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">é€šçŸ¥æ­·å²è¨˜éŒ„</div>
                    <div id="notification-history" class="notification-history">
                        è¼‰å…¥ä¸­...
                    </div>
                    <button class="btn btn-secondary" onclick="loadNotificationHistory()">
                        <i class="fas fa-sync"></i> é‡æ–°è¼‰å…¥æ­·å²
                    </button>
                </div>
            </div>
            
            <!-- å‚™ä»½ç®¡ç† -->
            <div id="backup" class="content-section">
                <h2 class="section-title">
                    <i class="fas fa-database"></i> æ•¸æ“šå‚™ä»½ç®¡ç†
                </h2>
                
                <div class="card">
                    <div class="card-header">è‡ªå‹•å‚™ä»½è¨­å®š</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="auto-backup-enabled" checked> å•Ÿç”¨è‡ªå‹•å‚™ä»½
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="backup-interval">å‚™ä»½é–“éš”ï¼ˆå¤©ï¼‰</label>
                            <input type="number" id="backup-interval" value="7" min="1" max="30">
                        </div>
                        <div class="form-group">
                            <label for="keep-backups">ä¿ç•™å‚™ä»½æ•¸é‡</label>
                            <input type="number" id="keep-backups" value="30" min="5" max="100">
                        </div>
                    </div>
                    
                    <button class="btn btn-success" onclick="saveBackupSettings()">
                        <i class="fas fa-save"></i> å„²å­˜å‚™ä»½è¨­å®š
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">æ‰‹å‹•å‚™ä»½</div>
                    <div class="backup-status">
                        <div id="backup-status">
                            <p><strong>ä¸Šæ¬¡å‚™ä»½ï¼š</strong><span id="last-backup">å¾æœªå‚™ä»½</span></p>
                            <p><strong>æ•¸æ“šåº«å¤§å°ï¼š</strong><span id="db-size">è¨ˆç®—ä¸­...</span></p>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="createBackup()">
                        <i class="fas fa-download"></i> ç«‹å³å‚™ä»½
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">å‚™ä»½è¨˜éŒ„</div>
                    <div id="backup-list" class="backup-list">
                        è¼‰å…¥ä¸­...
                    </div>
                    <button class="btn btn-secondary" onclick="loadBackupList()">
                        <i class="fas fa-sync"></i> é‡æ–°è¼‰å…¥
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let currentSection = 'dashboard';
        let systemData = {};
        
        // ğŸ§ª æ¨¡æ“¬æ¨¡å¼é…ç½®
        const MOCK_MODE = false;  // é—œé–‰æ¨¡æ“¬æ¨¡å¼ï¼Œä½¿ç”¨çœŸå¯¦API
        const API_BASE = 'http://localhost:3002';
        
        // ğŸ§ª æ¨¡æ“¬fetchå‡½æ•¸
        async function mockFetch(url, options = {}) {
            console.log('ğŸ§ª ç®¡ç†å“¡æ¨¡æ“¬APIèª¿ç”¨:', url, options);
            await new Promise(resolve => setTimeout(resolve, 100));
            
            if (url.includes('/api/health')) {
                return {
                    ok: true,
                    json: async () => MockAPI.health()
                };
            }
            
            if (url.includes('/api/admin/employees')) {
                return {
                    ok: true,
                    json: async () => MockAPI.getAdminEmployees()
                };
            }
            
            if (url.includes('/api/admin/stores')) {
                return {
                    ok: true,
                    json: async () => MockAPI.getAdminStores()
                };
            }
            
            if (url.includes('/api/admin/settings')) {
                return {
                    ok: true,
                    json: async () => MockAPI.getAdminSettings()
                };
            }
            
            if (url.includes('/api/admin/ordering-items')) {
                return {
                    ok: true,
                    json: async () => MockAPI.getOrderingItems()
                };
            }
            
            if (url.includes('/api/admin/photos/stats')) {
                return {
                    ok: true,
                    json: async () => MockAPI.getPhotoStats()
                };
            }
            
            if (url.includes('/api/admin/photos')) {
                const url_obj = new URL(url);
                const page = url_obj.searchParams.get('page') || 1;
                const limit = url_obj.searchParams.get('limit') || 20;
                return {
                    ok: true,
                    json: async () => MockAPI.getAdminPhotos(page, limit)
                };
            }
            
            // é»˜èªéŸ¿æ‡‰
            return {
                ok: false,
                status: 404,
                json: async () => ({ success: false, message: 'æ¨¡æ“¬APIç«¯é»æœªæ‰¾åˆ°' })
            };
        }
        
        // æ›¿æ›fetchå‡½æ•¸
        if (MOCK_MODE) {
            window.fetch = mockFetch;
        }
        
        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemData();
            loadDashboard();
        });
        
        // é¡¯ç¤ºæŒ‡å®šå€å¡Š
        function showSection(sectionName) {
            // éš±è—æ‰€æœ‰å€å¡Š
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰é¸å–®é …ç›®çš„activeç‹€æ…‹
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // é¡¯ç¤ºæŒ‡å®šå€å¡Š
            document.getElementById(sectionName).classList.add('active');
            
            // è¨­å®šå°æ‡‰é¸å–®é …ç›®ç‚ºactive
            event.target.classList.add('active');
            
            currentSection = sectionName;
            
            // è¼‰å…¥å°æ‡‰æ•¸æ“š
            switch(sectionName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'stores':
                    loadStores();
                    break;
                case 'employees':
                    loadEmployees();
                    break;
                case 'ordering':
                    loadOrderingItems();
                    break;
                case 'schedule':
                    loadScheduleSettings();
                    break;
                case 'voting':
                    loadVotingPositions();
                    break;
                case 'revenue':
                    loadRevenueSettings();
                    break;
                case 'photos':
                    loadPhotoManagement();
                    break;
                case 'test-tools':
                    // æ¸¬è©¦å·¥å…·ç„¡éœ€ç‰¹æ®Šè¼‰å…¥
                    break;
                case 'notifications':
                    loadNotificationHistory();
                    break;
                case 'backup':
                    loadBackupSettings();
                    loadBackupList();
                    break;
                case 'system':
                    loadSystemSettings();
                    break;
            }
        }
        
        // è¼‰å…¥ç³»çµ±æ•¸æ“š
        async function loadSystemData() {
            try {
                const response = await fetch('/api/health');
                systemData = await response.json();
            } catch (error) {
                console.error('è¼‰å…¥ç³»çµ±æ•¸æ“šå¤±æ•—:', error);
            }
        }
        
        // è¼‰å…¥ç³»çµ±ç¸½è¦½
        async function loadDashboard() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                // æ›´æ–°å“¡å·¥çµ±è¨ˆ
                document.getElementById('employee-stats').innerHTML = `
                    <p><strong>ç¸½å“¡å·¥æ•¸:</strong> ${data.statistics.totalEmployees} äºº</p>
                    <p><strong>åˆ†åº—æ•¸:</strong> ${data.statistics.totalStores} é–“</p>
                `;
                
                // æ›´æ–°åˆ†åº—çµ±è¨ˆ
                document.getElementById('store-stats').innerHTML = `
                    <p><strong>å…§å£¢å¿ å­åº—:</strong> ç‡Ÿé‹ä¸­</p>
                    <p><strong>æ¡ƒåœ’é¾å®‰åº—:</strong> ç‡Ÿé‹ä¸­</p>
                    <p><strong>ä¸­å£¢é¾å´—åº—:</strong> ç‡Ÿé‹ä¸­</p>
                `;
                
                // æ›´æ–°ä»Šæ—¥æ•¸æ“š
                document.getElementById('daily-stats').innerHTML = `
                    <p><strong>è€ƒå‹¤è¨˜éŒ„:</strong> ${data.statistics.attendanceRecords} ç­†</p>
                    <p><strong>ç‡Ÿæ”¶è¨˜éŒ„:</strong> ${data.statistics.revenueRecords} ç­†</p>
                    <p><strong>å«è²¨è¨˜éŒ„:</strong> ${data.statistics.orderingRecords} ç­†</p>
                    <p><strong>ç¶­ä¿®è¨˜éŒ„:</strong> ${data.statistics.maintenanceRecords} ç­†</p>
                `;
                
                // æ›´æ–°ç³»çµ±ç‹€æ…‹
                document.getElementById('system-status').innerHTML = `
                    <p><strong>ç³»çµ±ç‰ˆæœ¬:</strong> ${data.version}</p>
                    <p><strong>æœå‹™ç‹€æ…‹:</strong> <span class="status-badge status-active">æ­£å¸¸é‹è¡Œ</span></p>
                    <p><strong>ä¸Šæ¬¡æ›´æ–°:</strong> ${new Date().toLocaleString('zh-TW')}</p>
                `;
                
            } catch (error) {
                showNotification('è¼‰å…¥ç³»çµ±ç¸½è¦½å¤±æ•—', 'error');
            }
        }
        
        // æ¸¬è©¦æ‰€æœ‰API
        async function testAllAPIs() {
            const testButton = event.target;
            testButton.disabled = true;
            testButton.innerHTML = '<div class="loading"></div> æ¸¬è©¦ä¸­...';
            
            const apis = [
                '/api/health',
                '/api/admin/employees', 
                '/api/attendance',
                '/api/revenue',
                '/api/ordering',
                '/api/maintenance'
            ];
            
            let results = [];
            
            for (let api of apis) {
                try {
                    const response = await fetch(api);
                    const status = response.ok ? 'âœ…' : 'âŒ';
                    results.push(`${status} ${api}: ${response.ok ? 'æ­£å¸¸' : 'éŒ¯èª¤'} (${response.status})`);
                } catch (error) {
                    results.push(`âŒ ${api}: é€£ç·šå¤±æ•—`);
                }
            }
            
            alert(`APIæ¸¬è©¦çµæœ:\n\n${results.join('\n')}`);
            
            testButton.disabled = false;
            testButton.innerHTML = '<i class="fas fa-flask"></i> æ¸¬è©¦æ‰€æœ‰API';
        }
        
        // è¼‰å…¥åˆ†åº—è¨­å®š
        async function loadStores() {
            try {
                const response = await fetch('/api/admin/stores');
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('stores-container');
                    container.innerHTML = '';
                    
                    data.data.forEach(store => {
                        const storeCard = document.createElement('div');
                        storeCard.className = 'store-card';
                        storeCard.innerHTML = `
                            <h3>${store.name}</h3>
                            <p><strong>åœ°å€:</strong> ${store.address}</p>
                            <p><strong>ç‡Ÿæ¥­æ™‚é–“:</strong> ${store.open}</p>
                            <p><strong>æœ€å°‘äººæ•¸:</strong> ${store.people} äºº</p>
                            <p><strong>æ‰“å¡ç¯„åœ:</strong> ${store.radius} å…¬å°º</p>
                            <p><strong>åº§æ¨™:</strong> ${store.latitude}, ${store.longitude}</p>
                            <button class="btn btn-primary" onclick="editStore('${store.storeId}')">
                                <i class="fas fa-edit"></i> ç·¨è¼¯
                            </button>
                        `;
                        container.appendChild(storeCard);
                    });
                }
            } catch (error) {
                showNotification('è¼‰å…¥åˆ†åº—è³‡æ–™å¤±æ•—', 'error');
            }
        }
        
        // è¼‰å…¥å“¡å·¥åˆ—è¡¨
        async function loadEmployees() {
            try {
                const response = await fetch('/api/admin/employees');
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('employees-container');
                    container.innerHTML = '';
                    
                    data.data.forEach(employee => {
                        const employeeCard = document.createElement('div');
                        employeeCard.className = 'employee-card';
                        
                        const statusClass = employee.isActive ? 'status-active' : 
                                           employee.status === 'å¯©æ ¸ä¸­' ? 'status-pending' : 'status-inactive';
                        
                        employeeCard.innerHTML = `
                            <div class="employee-info">
                                <h4>${employee.name}</h4>
                                <p><strong>ç·¨è™Ÿ:</strong> ${employee.employeeId}</p>
                                <p><strong>è·ä½:</strong> ${employee.position}</p>
                                <p><strong>åˆ†åº—:</strong> ${employee.store}</p>
                                <p><strong>ç‹€æ…‹:</strong> <span class="status-badge ${statusClass}">${employee.status}</span></p>
                            </div>
                            <div class="employee-actions">
                                <button class="btn btn-primary" onclick="editEmployee('${employee.employeeId}')">
                                    <i class="fas fa-edit"></i> ç·¨è¼¯
                                </button>
                                ${!employee.isActive ? 
                                    `<button class="btn btn-success" onclick="approveEmployee('${employee.employeeId}')">
                                        <i class="fas fa-check"></i> å¯©æ ¸é€šé
                                    </button>` : ''
                                }
                            </div>
                        `;
                        container.appendChild(employeeCard);
                    });
                }
            } catch (error) {
                showNotification('è¼‰å…¥å“¡å·¥è³‡æ–™å¤±æ•—', 'error');
            }
        }
        
        // å¯©æ ¸é€šéå“¡å·¥
        async function approveEmployee(employeeId) {
            if (!confirm('ç¢ºå®šè¦å¯©æ ¸é€šéæ­¤å“¡å·¥å—ï¼Ÿ')) return;
            
            try {
                const response = await fetch(`/api/admin/employees/${employeeId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        isActive: true,
                        status: 'åœ¨è·'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('å“¡å·¥å¯©æ ¸é€šé', 'success');
                    loadEmployees();
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('å¯©æ ¸å¤±æ•—', 'error');
            }
        }
        
        // è¼‰å…¥å«è²¨å“é …
        async function loadOrderingItems() {
            try {
                const response = await fetch('/api/admin/ordering-items');
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('ordering-items-container');
                    container.innerHTML = '<h3>ç›®å‰å“é …æ¸…å–®</h3>';
                    
                    // æŒ‰ä¾›æ‡‰å•†åˆ†çµ„
                    const groupedItems = {};
                    data.data.forEach(item => {
                        if (!groupedItems[item.supplier]) {
                            groupedItems[item.supplier] = [];
                        }
                        groupedItems[item.supplier].push(item);
                    });
                    
                    Object.keys(groupedItems).forEach(supplier => {
                        const supplierDiv = document.createElement('div');
                        supplierDiv.className = 'card';
                        supplierDiv.innerHTML = `
                            <div class="card-header">ğŸ­ ${supplier}</div>
                            ${groupedItems[supplier].map(item => `
                                <p>â€¢ ${item.brand} ${item.product} - $${item.unitPrice}/${item.unit}</p>
                            `).join('')}
                        `;
                        container.appendChild(supplierDiv);
                    });
                }
            } catch (error) {
                showNotification('è¼‰å…¥å“é …æ¸…å–®å¤±æ•—', 'error');
            }
        }
        
        // æ–°å¢å«è²¨å“é …
        async function addOrderingItem() {
            const formData = {
                supplier: document.getElementById('item-supplier').value,
                brand: document.getElementById('item-brand').value,
                product: document.getElementById('item-product').value,
                unit: document.getElementById('item-unit').value,
                unitPrice: parseFloat(document.getElementById('item-price').value),
                category: document.getElementById('item-category').value
            };
            
            // é©—è­‰è¡¨å–®
            if (!formData.supplier || !formData.brand || !formData.product || !formData.unit || !formData.unitPrice || !formData.category) {
                showNotification('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/admin/ordering-items', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('å“é …æ–°å¢æˆåŠŸ', 'success');
                    // æ¸…ç©ºè¡¨å–®
                    document.querySelectorAll('#ordering input, #ordering select').forEach(input => {
                        input.value = '';
                    });
                    loadOrderingItems();
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('æ–°å¢å“é …å¤±æ•—', 'error');
            }
        }
        
        // è¼‰å…¥æ’ç­è¨­å®š
        async function loadScheduleSettings() {
            try {
                const response = await fetch('/api/admin/settings');
                const data = await response.json();
                
                if (data.success && data.data.scheduling) {
                    const settings = data.data.scheduling;
                    document.getElementById('max-vacation-days').value = settings.maxVacationDays;
                    document.getElementById('max-daily-vacation').value = settings.maxDailyVacationTotal;
                    document.getElementById('max-weekend-vacation').value = settings.maxWeekendVacationDays;
                    document.getElementById('operation-time').value = settings.operationTimeMinutes;
                    document.getElementById('open-day').value = settings.openDay;
                    document.getElementById('close-day').value = settings.closeDay;
                }
            } catch (error) {
                showNotification('è¼‰å…¥æ’ç­è¨­å®šå¤±æ•—', 'error');
            }
        }
        
        // å„²å­˜æ’ç­è¨­å®š
        async function saveScheduleSettings() {
            const settings = {
                maxVacationDays: parseInt(document.getElementById('max-vacation-days').value),
                maxDailyVacationTotal: parseInt(document.getElementById('max-daily-vacation').value),
                maxWeekendVacationDays: parseInt(document.getElementById('max-weekend-vacation').value),
                operationTimeMinutes: parseInt(document.getElementById('operation-time').value),
                openDay: parseInt(document.getElementById('open-day').value),
                closeDay: parseInt(document.getElementById('close-day').value)
            };
            
            try {
                const response = await fetch('/api/admin/settings', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        category: 'scheduling',
                        settings: settings
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('æ’ç­è¨­å®šå„²å­˜æˆåŠŸ', 'success');
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('å„²å­˜æ’ç­è¨­å®šå¤±æ•—', 'error');
            }
        }
        
        // è¼‰å…¥æŠ•ç¥¨è·ä½è¨­å®š
        async function loadVotingPositions() {
            try {
                const response = await fetch('/api/admin/settings');
                const data = await response.json();
                
                if (data.success && data.data.voting && data.data.voting.positions) {
                    const container = document.getElementById('voting-positions-container');
                    container.innerHTML = '';
                    
                    data.data.voting.positions.forEach(position => {
                        const positionCard = document.createElement('div');
                        positionCard.className = 'card';
                        positionCard.innerHTML = `
                            <div class="card-header">éšç´š ${position.level} - ${position.name}</div>
                            <p><strong>è–ªè³‡:</strong> $${position.salary.toLocaleString()}</p>
                            <p><strong>çé‡‘æ¯”ä¾‹:</strong> ${(position.bonusRate * 100)}%</p>
                            <p><strong>åé¡:</strong> ${position.quota} äºº</p>
                            <p><strong>ä»»è·éœ€æ»¿:</strong> ${position.requiredDays} å¤©</p>
                            <p><strong>åŒæ„æ¯”ä¾‹:</strong> ${(position.approvalRate * 100)}%</p>
                            <p><strong>æŠ•ç¥¨æœŸé–“:</strong> ${position.votingPeriodDays} å¤©</p>
                            <p><strong>é²åˆ°é™åˆ¶:</strong> æ¯æœˆä¸è¶…é ${position.maxLateMinutesPerMonth} åˆ†é˜</p>
                            <p><strong>å‚™è¨»:</strong> ${position.notes}</p>
                        `;
                        container.appendChild(positionCard);
                    });
                }
            } catch (error) {
                showNotification('è¼‰å…¥æŠ•ç¥¨è¨­å®šå¤±æ•—', 'error');
            }
        }
        
        // è¼‰å…¥ç‡Ÿæ”¶è¨­å®š
        async function loadRevenueSettings() {
            try {
                const response = await fetch('/api/admin/settings');
                const data = await response.json();
                
                if (data.success && data.data.revenue) {
                    const revenue = data.data.revenue;
                    
                    document.getElementById('weekday-threshold').value = revenue.weekdayFormula.threshold;
                    document.getElementById('weekday-rate').value = revenue.weekdayFormula.rate * 100;
                    document.getElementById('holiday-threshold').value = revenue.holidayFormula.threshold;
                    document.getElementById('holiday-rate').value = revenue.holidayFormula.rate * 100;
                    
                    updateRevenueDisplay();
                }
            } catch (error) {
                showNotification('è¼‰å…¥ç‡Ÿæ”¶è¨­å®šå¤±æ•—', 'error');
            }
        }
        
        // æ›´æ–°ç‡Ÿæ”¶é¡¯ç¤º
        function updateRevenueDisplay() {
            document.getElementById('weekday-display').textContent = document.getElementById('weekday-threshold').value;
            document.getElementById('weekday-rate-display').textContent = document.getElementById('weekday-rate').value + '%';
            document.getElementById('holiday-display').textContent = document.getElementById('holiday-threshold').value;
            document.getElementById('holiday-rate-display').textContent = document.getElementById('holiday-rate').value + '%';
        }
        
        // å„²å­˜ç‡Ÿæ”¶è¨­å®š
        async function saveRevenueSettings() {
            const settings = {
                weekdayFormula: {
                    threshold: parseFloat(document.getElementById('weekday-threshold').value),
                    rate: parseFloat(document.getElementById('weekday-rate').value) / 100
                },
                holidayFormula: {
                    threshold: parseFloat(document.getElementById('holiday-threshold').value),
                    rate: parseFloat(document.getElementById('holiday-rate').value) / 100
                }
            };
            
            try {
                const response = await fetch('/api/admin/settings', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        category: 'revenue',
                        settings: settings
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('ç‡Ÿæ”¶è¨­å®šå„²å­˜æˆåŠŸ', 'success');
                    updateRevenueDisplay();
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                showNotification('å„²å­˜ç‡Ÿæ”¶è¨­å®šå¤±æ•—', 'error');
            }
        }
        
        // è¼‰å…¥ç³»çµ±è¨­å®š
        async function loadSystemSettings() {
            try {
                const response = await fetch('/api/admin/settings');
                const data = await response.json();
                
                if (data.success) {
                    // è¼‰å…¥ä½œå»¢è¨­å®š
                    if (data.data.voidSettings) {
                        document.getElementById('void-attendance').checked = data.data.voidSettings.attendance;
                        document.getElementById('void-revenue').checked = data.data.voidSettings.revenue;
                        document.getElementById('void-ordering').checked = data.data.voidSettings.ordering;
                        document.getElementById('void-maintenance').checked = data.data.voidSettings.maintenance;
                    }
                    
                    // è¼‰å…¥Telegramè¨­å®š
                    if (data.data.telegram) {
                        document.getElementById('bot-token').value = data.data.telegram.botToken;
                        document.getElementById('boss-group').value = data.data.telegram.bossGroupId;
                        document.getElementById('employee-group').value = data.data.telegram.employeeGroupId;
                    }
                }
            } catch (error) {
                showNotification('è¼‰å…¥ç³»çµ±è¨­å®šå¤±æ•—', 'error');
            }
        }
        
        // å„²å­˜ç³»çµ±è¨­å®š
        async function saveSystemSettings() {
            const settings = {
                voidSettings: {
                    attendance: document.getElementById('void-attendance').checked,
                    revenue: document.getElementById('void-revenue').checked,
                    ordering: document.getElementById('void-ordering').checked,
                    maintenance: document.getElementById('void-maintenance').checked
                },
                telegram: {
                    botToken: document.getElementById('bot-token').value,
                    bossGroupId: document.getElementById('boss-group').value,
                    employeeGroupId: document.getElementById('employee-group').value
                }
            };
            
            try {
                // åˆ†åˆ¥å„²å­˜å…©å€‹è¨­å®šé¡åˆ¥
                const voidResponse = await fetch('/api/admin/settings', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        category: 'voidSettings',
                        settings: settings.voidSettings
                    })
                });
                
                const telegramResponse = await fetch('/api/admin/settings', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        category: 'telegram',
                        settings: settings.telegram
                    })
                });
                
                const voidData = await voidResponse.json();
                const telegramData = await telegramResponse.json();
                
                if (voidData.success && telegramData.success) {
                    showNotification('ç³»çµ±è¨­å®šå„²å­˜æˆåŠŸ', 'success');
                } else {
                    showNotification('éƒ¨åˆ†è¨­å®šå„²å­˜å¤±æ•—', 'error');
                }
            } catch (error) {
                showNotification('å„²å­˜ç³»çµ±è¨­å®šå¤±æ•—', 'error');
            }
        }
        
        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
        
        // ç›£è½ç‡Ÿæ”¶è¨­å®šè¼¸å…¥è®ŠåŒ–
        document.addEventListener('input', function(e) {
            if (e.target.id.includes('weekday') || e.target.id.includes('holiday')) {
                updateRevenueDisplay();
            }
        });
        
        // ==================== æ¸¬è©¦å·¥å…·åŠŸèƒ½ ====================
        
        // åŸ·è¡Œå–®å€‹æ¸¬è©¦
        async function runTest(testId) {
            const resultsArea = document.getElementById('test-results');
            const timestamp = new Date().toLocaleString('zh-TW');
            
            try {
                // é¡¯ç¤ºé–‹å§‹æ¸¬è©¦
                appendTestResult('info', `[${timestamp}] é–‹å§‹åŸ·è¡Œæ¸¬è©¦: ${testId}`);
                
                const response = await fetch(`${API_BASE}/api/admin/test-tools/${testId}/execute`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const testData = result.data;
                    appendTestResult(
                        testData.testResult === 'PASS' ? 'pass' : 'fail',
                        `[${timestamp}] ${testId} - ${testData.testResult}: ${testData.details}`
                    );
                    
                    // é¡¯ç¤ºè©³ç´°ä¿¡æ¯
                    if (testData.testResult === 'PASS') {
                        Object.keys(testData).forEach(key => {
                            if (key !== 'testResult' && key !== 'details') {
                                appendTestResult('info', `  ${key}: ${JSON.stringify(testData[key])}`);
                            }
                        });
                    }
                } else {
                    appendTestResult('fail', `[${timestamp}] ${testId} - æ¸¬è©¦å¤±æ•—: ${result.message}`);
                }
            } catch (error) {
                appendTestResult('fail', `[${timestamp}] ${testId} - åŸ·è¡ŒéŒ¯èª¤: ${error.message}`);
            }
        }
        
        // åŸ·è¡Œå…¨éƒ¨æ¸¬è©¦
        async function runAllTests() {
            const testTools = [
                'employee-management', 'attendance-system', 'revenue-system',
                'ordering-system', 'maintenance-system', 'scheduling-system',
                'voting-system', 'announcement-system', 'photo-upload',
                'item-reports', 'data-backup', 'system-health'
            ];
            
            const resultsArea = document.getElementById('test-results');
            resultsArea.innerHTML = '';
            appendTestResult('info', `é–‹å§‹åŸ·è¡Œå…¨éƒ¨æ¸¬è©¦ (${testTools.length}å€‹æ¸¬è©¦é …ç›®)...`);
            
            let passed = 0;
            let failed = 0;
            
            for (const testId of testTools) {
                await runTest(testId);
                await new Promise(resolve => setTimeout(resolve, 500)); // å»¶é²500ms
            }
            
            appendTestResult('info', `\nå…¨éƒ¨æ¸¬è©¦å®Œæˆï¼`);
        }
        
        // æ·»åŠ æ¸¬è©¦çµæœåˆ°é¡¯ç¤ºå€åŸŸ
        function appendTestResult(type, message) {
            const resultsArea = document.getElementById('test-results');
            const resultElement = document.createElement('div');
            resultElement.className = `test-result-item test-result-${type}`;
            resultElement.textContent = message;
            resultsArea.appendChild(resultElement);
            resultsArea.scrollTop = resultsArea.scrollHeight;
        }
        
        // ==================== é€šçŸ¥ç®¡ç†åŠŸèƒ½ ====================
        
        // ç™¼é€æ¸¬è©¦é€šçŸ¥
        async function sendTestNotification(groupType) {
            try {
                const response = await fetch(`${API_BASE}/api/admin/test-tools/notification-${groupType}/execute`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`${groupType}ç¾¤çµ„æ¸¬è©¦é€šçŸ¥ç™¼é€æˆåŠŸï¼`, 'success');
                    loadNotificationHistory(); // é‡æ–°è¼‰å…¥é€šçŸ¥æ­·å²
                } else {
                    showNotification(`${groupType}ç¾¤çµ„æ¸¬è©¦é€šçŸ¥ç™¼é€å¤±æ•—: ${result.message}`, 'error');
                }
            } catch (error) {
                console.error('ç™¼é€æ¸¬è©¦é€šçŸ¥å¤±æ•—:', error);
                showNotification(`ç™¼é€æ¸¬è©¦é€šçŸ¥å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // ç™¼é€è‡ªè¨‚é€šçŸ¥
        async function sendCustomNotification() {
            const customMessage = document.getElementById('custom-message').value;
            const groups = ['boss', 'employee', 'system'];
            
            if (!customMessage.trim()) {
                showNotification('è«‹è¼¸å…¥è‡ªè¨‚è¨Šæ¯', 'warning');
                return;
            }
            
            try {
                for (const group of groups) {
                    const response = await fetch(`${API_BASE}/api/admin/notifications/test`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            groupType: group,
                            message: customMessage
                        })
                    });
                    
                    const result = await response.json();
                    if (!result.success) {
                        console.error(`${group}ç¾¤çµ„é€šçŸ¥ç™¼é€å¤±æ•—:`, result.message);
                    }
                }
                
                showNotification('è‡ªè¨‚é€šçŸ¥å·²ç™¼é€åˆ°æ‰€æœ‰ç¾¤çµ„ï¼', 'success');
                document.getElementById('custom-message').value = '';
                loadNotificationHistory();
            } catch (error) {
                console.error('ç™¼é€è‡ªè¨‚é€šçŸ¥å¤±æ•—:', error);
                showNotification(`ç™¼é€è‡ªè¨‚é€šçŸ¥å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // è¼‰å…¥é€šçŸ¥æ­·å²
        async function loadNotificationHistory() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/notifications/groups`);
                const result = await response.json();
                
                if (result.success) {
                    displayNotificationHistory(result.data.history);
                } else {
                    document.getElementById('notification-history').innerHTML = 'è¼‰å…¥å¤±æ•—';
                }
            } catch (error) {
                console.error('è¼‰å…¥é€šçŸ¥æ­·å²å¤±æ•—:', error);
                document.getElementById('notification-history').innerHTML = 'è¼‰å…¥å¤±æ•—';
            }
        }
        
        // é¡¯ç¤ºé€šçŸ¥æ­·å²
        function displayNotificationHistory(history) {
            const historyContainer = document.getElementById('notification-history');
            
            if (!history || history.length === 0) {
                historyContainer.innerHTML = '<div class="notification-item">æš«ç„¡é€šçŸ¥è¨˜éŒ„</div>';
                return;
            }
            
            const historyHtml = history.map(notification => `
                <div class="notification-item ${notification.success ? 'notification-success' : 'notification-error'}">
                    <div class="notification-header">
                        <span class="notification-group">${notification.groupType}</span>
                        <span class="notification-time">${new Date(notification.timestamp).toLocaleString('zh-TW')}</span>
                    </div>
                    <div>${notification.message.substring(0, 100)}${notification.message.length > 100 ? '...' : ''}</div>
                    ${!notification.success ? `<div style="color: #dc3545; font-size: 12px;">éŒ¯èª¤: ${notification.error}</div>` : ''}
                </div>
            `).join('');
            
            historyContainer.innerHTML = historyHtml;
        }
        
        // ==================== å‚™ä»½ç®¡ç†åŠŸèƒ½ ====================
        
        // è¼‰å…¥å‚™ä»½è¨­å®š
        async function loadBackupSettings() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/backup/settings`);
                const result = await response.json();
                
                if (result.success) {
                    const settings = result.data;
                    document.getElementById('auto-backup-enabled').checked = settings.enabled;
                    document.getElementById('backup-interval').value = settings.interval;
                    document.getElementById('keep-backups').value = settings.keepBackups;
                    
                    document.getElementById('last-backup').textContent = 
                        settings.lastBackup ? new Date(settings.lastBackup).toLocaleString('zh-TW') : 'å¾æœªå‚™ä»½';
                }
            } catch (error) {
                console.error('è¼‰å…¥å‚™ä»½è¨­å®šå¤±æ•—:', error);
            }
        }
        
        // å„²å­˜å‚™ä»½è¨­å®š
        async function saveBackupSettings() {
            try {
                const settings = {
                    enabled: document.getElementById('auto-backup-enabled').checked,
                    interval: parseInt(document.getElementById('backup-interval').value),
                    keepBackups: parseInt(document.getElementById('keep-backups').value)
                };
                
                const response = await fetch(`${API_BASE}/api/admin/backup/settings`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('å‚™ä»½è¨­å®šå·²å„²å­˜ï¼', 'success');
                } else {
                    showNotification(`å„²å­˜å¤±æ•—: ${result.message}`, 'error');
                }
            } catch (error) {
                console.error('å„²å­˜å‚™ä»½è¨­å®šå¤±æ•—:', error);
                showNotification(`å„²å­˜å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // ç«‹å³å‚™ä»½
        async function createBackup() {
            try {
                showNotification('æ­£åœ¨å‰µå»ºå‚™ä»½...', 'info');
                
                const response = await fetch(`${API_BASE}/api/admin/backup/create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`å‚™ä»½å‰µå»ºæˆåŠŸï¼å‚™ä»½ID: ${result.data.backupId}`, 'success');
                    loadBackupSettings();
                    loadBackupList();
                } else {
                    showNotification(`å‚™ä»½å¤±æ•—: ${result.message}`, 'error');
                }
            } catch (error) {
                console.error('å‰µå»ºå‚™ä»½å¤±æ•—:', error);
                showNotification(`å‚™ä»½å¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // è¼‰å…¥å‚™ä»½åˆ—è¡¨
        async function loadBackupList() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/backup/list`);
                const result = await response.json();
                
                if (result.success) {
                    displayBackupList(result.data);
                    
                    // è¨ˆç®—ä¸¦é¡¯ç¤ºæ•¸æ“šåº«å¤§å°
                    const totalSize = result.data.reduce((sum, backup) => sum + backup.size, 0);
                    document.getElementById('db-size').textContent = `${(totalSize / 1024).toFixed(2)} KB`;
                } else {
                    document.getElementById('backup-list').innerHTML = 'è¼‰å…¥å¤±æ•—';
                }
            } catch (error) {
                console.error('è¼‰å…¥å‚™ä»½åˆ—è¡¨å¤±æ•—:', error);
                document.getElementById('backup-list').innerHTML = 'è¼‰å…¥å¤±æ•—';
            }
        }
        
        // é¡¯ç¤ºå‚™ä»½åˆ—è¡¨
        function displayBackupList(backups) {
            const listContainer = document.getElementById('backup-list');
            
            if (!backups || backups.length === 0) {
                listContainer.innerHTML = '<div class="backup-item">æš«ç„¡å‚™ä»½è¨˜éŒ„</div>';
                return;
            }
            
            const listHtml = backups.map(backup => `
                <div class="backup-item">
                    <div class="backup-info">
                        <div><strong>${backup.id}</strong></div>
                        <div class="backup-time">${new Date(backup.timestamp).toLocaleString('zh-TW')}</div>
                        <div class="backup-size">${(backup.size / 1024).toFixed(2)} KB - ${backup.type}å‚™ä»½</div>
                    </div>
                </div>
            `).join('');
            
            listContainer.innerHTML = listHtml;
        }
        
        // ==================== ç…§ç‰‡ç®¡ç†åŠŸèƒ½ ====================
        
        let currentPhotoPage = 1;
        let photoPageSize = 20;
        let totalPhotoPages = 1;
        
        // è¼‰å…¥ç…§ç‰‡ç®¡ç†
        async function loadPhotoManagement() {
            await loadPhotoStats();
            await loadPhotoStores();
            await loadPhotos();
        }
        
        // è¼‰å…¥ç…§ç‰‡çµ±è¨ˆ
        async function loadPhotoStats() {
            try {
                const response = await fetch('/api/admin/photos/stats');
                const result = await response.json();
                
                if (result.success) {
                    const stats = result.data;
                    document.getElementById('total-photos').textContent = stats.totalPhotos;
                    document.getElementById('revenue-photos').textContent = stats.revenuePhotos;
                    document.getElementById('maintenance-photos').textContent = stats.maintenancePhotos;
                }
            } catch (error) {
                console.error('è¼‰å…¥ç…§ç‰‡çµ±è¨ˆå¤±æ•—:', error);
            }
        }
        
        // è¼‰å…¥åˆ†åº—é¸é …
        async function loadPhotoStores() {
            try {
                const response = await fetch('/api/admin/stores');
                const result = await response.json();
                
                if (result.success) {
                    const storeSelect = document.getElementById('photo-store');
                    storeSelect.innerHTML = '<option value="">å…¨éƒ¨åˆ†åº—</option>';
                    
                    result.data.forEach(store => {
                        const option = document.createElement('option');
                        option.value = store.storeId;
                        option.textContent = store.name;
                        storeSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('è¼‰å…¥åˆ†åº—åˆ—è¡¨å¤±æ•—:', error);
            }
        }
        
        // è¼‰å…¥ç…§ç‰‡åˆ—è¡¨
        async function loadPhotos() {
            try {
                const type = document.getElementById('photo-type').value;
                const storeId = document.getElementById('photo-store').value;
                const startDate = document.getElementById('photo-start-date').value;
                const endDate = document.getElementById('photo-end-date').value;
                
                const params = new URLSearchParams({
                    page: currentPhotoPage,
                    limit: photoPageSize
                });
                
                if (type) params.append('type', type);
                if (storeId) params.append('storeId', storeId);
                if (startDate) params.append('startDate', startDate);
                if (endDate) params.append('endDate', endDate);
                
                const response = await fetch(`/api/admin/photos?${params}`);
                const result = await response.json();
                
                if (result.success) {
                    displayPhotos(result.data.photos);
                    updatePhotoPagination(result.data.pagination);
                } else {
                    document.getElementById('photo-grid').innerHTML = `<div class="loading">è¼‰å…¥å¤±æ•—: ${result.message}</div>`;
                }
            } catch (error) {
                console.error('è¼‰å…¥ç…§ç‰‡å¤±æ•—:', error);
                document.getElementById('photo-grid').innerHTML = '<div class="loading">è¼‰å…¥å¤±æ•—</div>';
            }
        }
        
        // é¡¯ç¤ºç…§ç‰‡
        function displayPhotos(photos) {
            const photoGrid = document.getElementById('photo-grid');
            
            if (photos.length === 0) {
                photoGrid.innerHTML = '<div class="loading">æš«ç„¡ç…§ç‰‡</div>';
                return;
            }
            
            const photosHtml = photos.map(photo => `
                <div class="photo-item">
                    <img src="/uploads/${photo.filename}" 
                         alt="${photo.recordTypeName}ç…§ç‰‡" 
                         class="photo-thumbnail"
                         onclick="viewPhoto('${photo.filename}', '${photo.recordTypeName}')">
                    <div class="photo-info">
                        <span class="photo-type ${photo.recordType}">${photo.recordTypeName}</span>
                        <div><strong>å“¡å·¥:</strong> ${photo.employeeName}</div>
                        <div><strong>åˆ†åº—:</strong> ${photo.storeName}</div>
                        <div><strong>æ—¥æœŸ:</strong> ${new Date(photo.date).toLocaleDateString('zh-TW')}</div>
                        ${photo.category ? `<div><strong>é¡åˆ¥:</strong> ${photo.category}</div>` : ''}
                        ${photo.equipment ? `<div><strong>è¨­å‚™:</strong> ${photo.equipment}</div>` : ''}
                        <div><strong>ä¸Šå‚³æ™‚é–“:</strong> ${new Date(photo.uploadTime).toLocaleString('zh-TW')}</div>
                    </div>
                </div>
            `).join('');
            
            photoGrid.innerHTML = photosHtml;
        }
        
        // æ›´æ–°åˆ†é æ§åˆ¶
        function updatePhotoPagination(pagination) {
            totalPhotoPages = pagination.totalPages;
            
            document.getElementById('photo-pagination-info').textContent = 
                `ç¬¬ ${pagination.currentPage} é ï¼Œå…± ${pagination.totalItems} ç­†`;
            
            document.getElementById('photo-prev-page').disabled = pagination.currentPage <= 1;
            document.getElementById('photo-next-page').disabled = pagination.currentPage >= pagination.totalPages;
        }
        
        // æœå°‹ç…§ç‰‡
        function searchPhotos() {
            currentPhotoPage = 1;
            loadPhotos();
        }
        
        // é‡æ–°æ•´ç†ç…§ç‰‡
        function refreshPhotos() {
            loadPhotoStats();
            loadPhotos();
        }
        
        // æ›´æ”¹ç…§ç‰‡é é¢
        function changePhotoPage(direction) {
            const newPage = currentPhotoPage + direction;
            if (newPage >= 1 && newPage <= totalPhotoPages) {
                currentPhotoPage = newPage;
                loadPhotos();
            }
        }
        
        // æŸ¥çœ‹ç…§ç‰‡
        function viewPhoto(filename, type) {
            // å‰µå»ºæ¨¡æ…‹æ¡†ä¾†é¡¯ç¤ºå¤§åœ–
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
            `;
            
            const img = document.createElement('img');
            img.src = `/uploads/${filename}`;
            img.style.cssText = `
                max-width: 90%;
                max-height: 90%;
                border-radius: 10px;
            `;
            
            modal.appendChild(img);
            modal.onclick = () => document.body.removeChild(modal);
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>